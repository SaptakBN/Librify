<div *ngIf="loggedIn()" class="container-fluid bg-dark">
  <h1 class="container text-light py-3">My Library</h1>
</div>
<div class="container mx-auto my-5">
  <div class="d-flex">
    <div class="profile">
      <div class="profile-img">
        <img [src]="userData?.img" width="200px" alt="">
      </div>
      <h3 class="my-2">{{userData?.fname}} {{userData?.lname}}</h3>
      <h4 class="my-2">{{userData?.mail}}</h4>
      <h4 class="my-2">Books in library: {{userData?.library.length}}</h4>
      <h4 class="my-2">Comics in library: {{userData?.comics.length}}</h4>
    </div>
    <div class="library w-100 mx-5">
      <div class="w-100">
        <div class="row w-100">
          <ng-container *ngFor="let book of userData?.library">
            <div class="col-3">
              <div class="card card my-2 p-3">
                <img class="w-100" src="https://covers.openlibrary.org/b/id/{{book.cover_id}}-M.jpg" alt=""
                  data-bs-toggle="modal" data-bs-target="#card" (click)="reviewFor2(book?.title, 'book')">
              </div>
            </div>
          </ng-container>
          <ng-container *ngFor="let comic of userData?.comics">
            <div class="col-3">
              <div class="card card my-2 p-3">
                <img class="w-100" src="{{comic?.thumbnail?.path}}.{{comic?.thumbnail?.extension}}" alt=""
                  data-bs-toggle="modal" data-bs-target="#card" (click)="reviewFor2(comic?.title, 'comic')">
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- card modal -->


<div class="modal fade" id="card" tabindex="-1" aria-labelledby="cardLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <!-- <div class="modal-header">
      </div> -->
      <button type="button" class="btn-close ms-auto mt-2 me-2 p-2" data-bs-dismiss="modal" aria-label="Close"></button>
      <div class="modal-body d-flex flex-column">
        <ng-container *ngIf="reviewType=='book'">
          <div class="d-flex">
            <img class="w-50 rounded-2 mx-2" src="https://covers.openlibrary.org/b/id/{{reviewBookData[0].cover_id}}-L.jpg"
            alt="">
            <div>
              <h1 class="fs-5" id="cardLabel">Title: {{reviewForTitle}}</h1>
              <h1 class="fs-5" id="cardLabel">Author: {{reviewBookData[0]?.authors}}</h1>
            </div>
          </div>
          <div class="d-flex justify-content-between my-2">
            <button (click)="remove(reviewBookData[0].title, 'book')" class="btn btn-danger w-100 btn-sm mx-2">Remove from library</button>
            <button *ngIf="!reviewOrNot(reviewBookData[0].title)" data-bs-toggle="modal" data-bs-target="#reviewModal"
              (click)="reviewFor(reviewBookData[0].title, 'book')" class="btn btn-success w-100 btn-sm mx-2">Give a Review</button>
            <button *ngIf="reviewOrNot(reviewBookData[0].title)" data-bs-toggle="modal" data-bs-target="#editReviewModal"
              (click)="reviewFor(reviewBookData[0].title, 'book')" class="btn btn-dark w-100 btn-sm mx-2">Edit Review</button>
            <button *ngIf="reviewOrNot(reviewBookData[0].title)" (click)="deleteReview(reviewBookData[0].title, 'book')"
              class="btn btn-danger w-100 btn-sm mx-2">Delete Review</button>
          </div>
        </ng-container>
        <ng-container *ngIf="reviewType=='comic'">
          <div class="d-flex">
            <img class="w-50 rounded-2 mx-2" *ngIf="reviewType=='comic'"
              src="{{reviewBookData[0].thumbnail.path}}.{{reviewBookData[0].thumbnail.extension}}" alt="">
            <div>
              <h1 class="fs-5" id="cardLabel">Title: {{reviewForTitle}}</h1>
              <h1 class="fs-5" id="cardLabel">Publisher: Marvel</h1>
            </div>
          </div>
          <div class="d-flex justify-content-between my-2">
            <button (click)="remove(reviewBookData[0].title, 'comic')" class="btn btn-danger w-100 btn-sm mx-2">Remove from library</button>
            <button *ngIf="!reviewOrNot(reviewBookData[0].title)" data-bs-toggle="modal" data-bs-target="#reviewModal"
              (click)="reviewFor(reviewBookData[0].title, 'comic')" class="btn btn-success w-100 btn-sm mx-2">Give a Review</button>
            <button *ngIf="reviewOrNot(reviewBookData[0].title)" data-bs-toggle="modal" data-bs-target="#editReviewModal"
              (click)="reviewFor(reviewBookData[0].title, 'comic')" class="btn btn-dark w-100 btn-sm mx-2">Edit Review</button>
            <button *ngIf="reviewOrNot(reviewBookData[0].title)" (click)="deleteReview(reviewBookData[0].title, 'comic')"
              class="btn btn-danger w-100 btn-sm mx-2">Delete Review</button>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>


<!--add review Modal -->
<div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="reviewModalLabel">Write a review</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Title: {{reviewForTitle| titlecase | slice:0:30 }}</p>
        <textarea class="w-100 rounded-2" [(ngModel)]="reviewData"></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button (click)="saveReview()" type="submit" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
<!-- edit review -->
<div class="modal fade" id="editReviewModal" tabindex="-1" aria-labelledby="editReviewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="editReviewModalLabel">Edit your review</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Title: {{reviewForTitle| titlecase | slice:0:30 }}</p>
        <textarea class="w-100 rounded-2" [(ngModel)]="reviewData"></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button (click)="updateReview()" type="submit" class="btn btn-primary">Update review</button>
      </div>
    </div>
  </div>
</div>
